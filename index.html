<!doctype html>

<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Staty</title>
    <meta name="description" content="Check sites for data privacy and security">
    <meta name="author" content="Kolmogorov's gang">
    <link rel="stylesheet" href="style.css">
</head>

<body>
<div class="container">
    <div class="header">
        <!--<div class="search">-->
        <!--<input type="text" placeholder="URL, e.g. google.com">-->
        <!--<button>Check!</button>-->
        <!--</div>-->
        <div class="logo"><b>PRIVACY</b>BENCHMARK</div>
    </div>
    <div class="description">
        <h1 class="siteDescription">
            Is your website private enough?
        </h1>
        <span class="shadowedText">
            Enter website url to check if this site sends your data to 3rd parties. Information is presented as a char to compare your site with others
        </span>
        <div class="search">
            <input type="text" placeholder="URL, e.g. google.com" id="checkInput">
            <button onclick="check()">Check!</button>
        </div>
    </div>
    <div class="chart">
        <svg width="960" height="300"></svg>
    </div>
</div>
<script>
    const IP = '34.65.75.228'

    // Example:
    // let response1 = {
    //     'websites': {
    //         'g.com': {
    //             x: -0.5,
    //             y:
    //                 0.3,
    //             score:
    //                 2
    //         },
    //         'ya.com': {
    //             x: -0.54,
    //             y:
    //                 0.13,
    //             score:
    //                 5
    //         }
    //     }
    // }

    function loadMainData() {
        return fetch('http://' + IP + '/api/data', {method: 'get'})
    }

    function loadWebsiteData(url) {
        fetch('http://' + IP + '/api/website?hostname=' + encodeURI(url), {method: 'get'})
            .then(response => {
                addSite(response.json())
                preRender()
            })
            .catch(error => {
                console.error(error)
            })
    }
</script>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script src="./d3.v4.min.js"></script>
<script>
    let resultResponse
    loadMainData().then(response => {
        resultResponse = response.json().websites
    })
        .catch(error => {
            console.log(error)
        })


    function check() {
        let url = document.getElementById('checkInput').value
        loadWebsiteData(url)
    }

    function addSite(site) {
        data.push([site.x, site.y])
    }

    function preRender() {
        // Source: https://bl.ocks.org/mbostock/87746f16b83cb9d5371394a001cbd772

        var svg = d3.select("svg"),
            margin = {top: 50, right: 50, bottom: 100, left: 50},
            width = +svg.attr("width") - margin.left - margin.right,
            height = +svg.attr("height") - margin.top - margin.bottom,
            g = svg.append("g").attr("transform", "translate(" + margin.left + "," + margin.top + ")")

        var x = d3.scaleLinear()
            .domain([0, 10])
            .range([0, width])

        var y = d3.scaleLinear()
            .range([height, 0])

        var brush = d3.brushX()
            .extent([[0, 0], [width, height]])
            .on("start brush", brushed)

        var dot = g.append("g")
            .attr("fill-opacity", 0.2)
            .selectAll("circle")
            .data(data)
            .enter().append("circle")
            .attr("transform", function (d) {
                return "translate(" + x(d[0]) + "," + y(d[1]) + ")"
            })
            .attr("r", 3.5)

        g.append("g")
            .call(brush)
            .call(brush.move, [3, 5].map(x))
            .selectAll(".overlay")
            .on("mousedown touchstart", beforebrushed, true)

        g.append("g")
            .attr("transform", "translate(0," + height + ")")
            .call(d3.axisBottom(x))

        function beforebrushed() {
            d3.event.stopImmediatePropagation()
            d3.select(this.parentNode).transition().call(brush.move, x.range())
        }

        function brushed() {
            var extent = d3.event.selection.map(x.invert, x)
            dot.classed("selected", function (d) {
                return extent[0] <= d[0] && d[0] <= extent[1]
            })
        }
    }

    preRender()
</script>

</body>
</html>